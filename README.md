# INTELLIDRONE API

## BRANCHING MODEL

----------------------

* Default branch when pull is DEVELOP.
* Master branch is protected and it is not possible to push. Create a merge request instead.

## DEPLOYMENT

----------------------

* **MASTER BRANCH:** it creates a docker image with node with the tag intellidrone/api:latest and it applies node server in [webagro production server](http://web.robotagro.com/api).
* **DEVELOP BRANCH:** it creates a docker image with node with the tag intellidrone/api:develop and it applies node server in [webagro development server](http://web.robotagro.com/api-develop).

## UPLOAD TO PRODUCTION

----------------------

To upload code in production, you must have a gitlab user credentials and server public key in base64 format. Then, executes the following code:

```bash
./upload_to_node_server.sh production USER PASSWORD
```

To upload code in development, use the following:

```bash
./upload_to_node_server.sh development USER PASSWORD
```

## DOCKER IMAGES

----------------------

The image name is: **intellidrone/api**. Available TAGs:

* **latest:** from master branch.
* **develop:** from develop branch.

## API TOKENS

----------------------

In order to use the api, a token must be generated and add it to **app_tokens.json**. Use [this page](https://www.xorbin.com/tools/sha256-hash-calculator) to calculate the SHA-256 of the password. That file must be filled as:

```json
[
    {
        "name": "APP NAME",
        "token": "TOKEN GENERATED BY SHA-256",
        "password": "Phrase to be encrypted"
    },
    {
        "name": "APP NAME 2",
        "token": "TOKEN GENERATED BY SHA-256",
        "password": "Phrase to be encrypted"
    }
]
```

## DATABASE CONNECTIONS

----------------------

In order to connect the api with a database, there are 3 thing to consider:

1. A definition must me placed in **.env** file called *DB_MAIN_CLIENT*.
2. To use a database inside a docker container, place the definition *DATABASE_LOCAL=1* inside **.env** file.
3. A file called **database.json** must be created following the next prototype:

```json
{
    "MAIN_DB":{
        "development":{
            "client": "mongo",
            "connection": {
            "host"     : "127.0.0.1",
            "user"     : "root",
            "password" : "PassWord",
            "database" : "vacas",
            "charset"  : "utf8"
            }
        },
        "docker":{
            "client": "mongo",
            "connection": {
            "host"     : "database",
            "user"     : "root",
            "password" : "DockerPassWORD",
            "database" : "vacas",
            "charset"  : "utf8"
            }
        },
        "production":{
            "client": "mongo",
            "connection": {
            "host"     : "127.0.0.1",
            "user"     : "",
            "password" : "",
            "database" : "vacas",
            "charset"  : "utf8"
            }
        }
    }
}
```

----------------------
Â© [Singleton](http://singleton.com.ar), Argentina, 2018.